# Задание T3: Тест-план и тест-кейсы для API расчёта стоимости продукта

---

## **Условие задачи:**

-   Реализовано REST API **GET** `/products/{productId}/cost?authToken=&count=&start=`
-   Функция возвращает стоимость продукта, в качестве входных данных функция принимает параметры:
   -   `count` - количество экземпляров продукта (1-5, партиями по 5)
   -   `start` - индекс с которого необходимо вычислять стоимость (количество уже приобретенных продуктов)

**Таблица стоимости:**

| Количество приобретенных продуктов | 1 | 2 | 3 | 4 | 5 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Стоимость** | 30 | 25 | 20 | 15 | 10 |

-   Вычисление стоимости выполняется нарастающим итогом.
-   Возможно приобрести только партиями по 5 экземпляров, если запрашивается больше, то считается партиями по 5.
-   `authToken` - параметр авторизации и аутентификации, набор из 16 символов, включающие цифры и буквы.
-   Функция возвращает ответ в json формате с http-кодом 200: `{ "cost": 100 }`.
-   В случае если продукт не найден возвращается ответ с кодом 404.
-   При неверном или отсутствующем токене - ответ с кодом 401.
-   В случае ошибки http-код 500 с телом в формате json `{"errorMessage": }`.

---

## **1. Тест-план**

### **1.1 Объект тестирования**
REST API метод **GET** `/products/{productId}/cost` с параметрами:
-   **productId** (обязательный) — идентификатор продукта в пути URL.
-   **authToken** (обязательный) — токен авторизации, 16 символов (буквы и цифры).
-   **count** (требует уточнения — обязательный или нет?) — количество экземпляров продукта (1-5, партиями по 5).
-   **start** (требует уточнения — обязательный или нет?) — индекс с которого вычислять стоимость (количество уже приобретенных продуктов).

### **1.2 Цели тестирования**
1.  Проверить корректность расчёта стоимости по таблице.
2.  Проверить правильность нарастающего итога при расчёте.
3.  Убедиться в корректной обработке партий по 5 экземпляров.
4.  Проверить систему авторизации (валидация `authToken`).
5.  Проверить обработку ошибок (404, 401, 500).
6.  Выяснить статус параметров `count` и `start` (обязательные/необязательные).

### **1.3 Критерии начала тестирования**
-   Получены и проанализированы требования к API.
-   Доступно тестовое окружение с развернутым API.
-   Подготовлены тестовые данные (валидные `productId`, `authToken`).
-   Подтверждена таблица стоимости и бизнес-логика расчёта.
-   Уточнена обязательность параметров `count` и `start` с командой разработки.
-   Утвержден тест-план.

### **1.4 Критерии завершения тестирования**
-   Выполнены все запланированные тест-кейсы (100%).
-   Проверены все комбинации параметров согласно таблице стоимости.
-   Задокументированы все найденные дефекты.
-   Достигнуто покрытие всех требований.
-   Критические и блокирующие баги исправлены и перепроверены.
-   Получены ответы на все неопределённости требований.

### **1.5 Стратегия тестирования**

| Вид тестирования | Описание | Техники тест-дизайна |
| :--- | :--- | :--- |
| **Функциональное** | Проверка расчёта стоимости по таблице | Эквивалентное разбиение, таблицы решений |
| **Тестирование бизнес-логики** | Проверка нарастающего итога и партий по 5 | Анализ состояний и переходов |
| **Тестирование безопасности** | Проверка авторизации | Предугадывание ошибок |
| **Тестирование API** | Проверка REST API endpoints | Граничные значения |
| **Тестирование обработки ошибок** | Проверка кодов ответов 401, 404, 500 | Причина-следствие |
| **Исследовательское тестирование** | Выяснение неопределённых аспектов требований | Исследовательское тестирование |

### **1.6 Риски и ограничения**

| Риск | Вероятность | Влияние | Меры по снижению |
| :--- | :--- | :--- | :--- |
| Неполнота требований по обязательности параметров | Средняя | Высокое | Запросить уточнение у команды разработки до начала тестирования |
| Неправильная интерпретация бизнес-логики | Средняя | Высокое | Детальный разбор примеров в требованиях, согласование с разработчиком |
| Отсутствие тестового окружения | Высокая | Критическое | Использование mock-сервера или эмуляция ответов |

### **1.7 График работы**

| Этап | Длительность         | Описание работ                                                 |
| :--- |:---------------------|:---------------------------------------------------------------|
| Анализ требований и бизнес-логики | 1 день               | Изучение таблицы стоимости, логики партий и нарастающего итога |
| Уточнение обязательности параметров | 0.5 дня              | Запрос уточнений у команды разработки                          |
| Создание тест-плана | 1 день               | Документирование стратегии тестирования                        |
| Написание тест-кейсов | 1 день               | Создание тест-кейсов для ключевых сценариев                        |
| Выполнение тестирования | 2 дня                | Тестирование через API-клиент, проверка расчётов               |
| Анализ результатов и отчет | 1 день               | Составление отчета, документация дефектов                      |
| **Общая длительность** | **6.5 рабочих дней** |                                                                |

### **1.8 Ресурсы**
-   **Инструменты**: Postman/Insomnia для отправки запросов, калькулятор для проверки расчётов.
-   **Документация**: Спецификация API, таблица стоимости.
-   **Команда**: 1 тестировщик.
-   **Окружение**: Тестовый сервер с API.

### **1.9 Отслеживание прогресса**
Данный раздел будет заполняться по мере выполнения работ в ходе реального тестирования.

---

## **2. Тест-кейсы**

### **2.1 Позитивные тест-кейсы**

#### **TC-T3-001: Базовый успешный запрос с минимальными параметрами**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=1`, `start=0`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=1&start=0`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **200**
    -   Тело ответа: `{"cost": 30}`
    -   Content-Type: `application/json`

#### **TC-T3-002: Успешный запрос с комбинацией count=3, start=1**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=3`, `start=1`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=3&start=1`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **200**
    -   Тело ответа: `{"cost": 60}` (25+20+15)

#### **TC-T3-003: Полная партия (5 продуктов)**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=5`, `start=0`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=5&start=0`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **200**
    -   Тело ответа: `{"cost": 100}` (30+25+20+15+10)

#### **TC-T3-004: Переход между партиями (count=7, start=3)**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=7`, `start=3`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=7&start=3`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **200**
    -   Тело ответа: `{"cost": 125}` (15+10 + 30+25+20+15+10)

### **2.2 Негативные тест-кейсы**

#### **TC-T3-005: Запрос без authToken**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `count=1`, `start=0`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?count=1&start=0`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **401**

#### **TC-T3-006: Запрос с неверным authToken**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=invalid_token123`, `count=1`, `start=0`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=invalid_token123&count=1&start=0`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **401**

#### **TC-T3-007: Запрос к несуществующему продукту**
*   **Тестовые данные:** `productId=999999`, `authToken=abc123def456gh78`, `count=1`, `start=0`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/999999/cost?authToken=abc123def456gh78&count=1&start=0`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **404**

#### **TC-T3-008: Провокация внутренней ошибки сервера**
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=abc` (нечисловое значение).
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=abc`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:**
    -   HTTP статус: **500**
    -   Тело ответа: `{"errorMessage": "..."}`

### **2.3 Исследовательские тест-кейсы (вопросы к API)**
> ⚠️ *В задании T1 параметры явно указаны как необязательные. В T3 аналогичного указания нет. Требуется уточнение у команды разработки.*

#### **TC-T3-009: Запрос без параметров count и start**
*   **Цель:** Выяснить поведение при минимальном запросе.
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:** *Требуется уточнение требований.*

#### **TC-T3-010: Запрос только с count=1**
*   **Цель:** Проверить, используется ли значение start по умолчанию (0).
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `count=1`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&count=1`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:** *Требуется уточнение требований.*

#### **TC-T3-011: Запрос только с start=2**
*   **Цель:** Проверить, является ли count обязательным.
*   **Предусловия:** Продукт с ID=123 существует в системе.
*   **Тестовые данные:** `productId=123`, `authToken=abc123def456gh78`, `start=2`.
*   **Шаги:**
    1.  Отправить GET запрос: `/products/123/cost?authToken=abc123def456gh78&start=2`
    2.  Зафиксировать ответ сервера.
*   **Ожидаемый результат:** *Требуется уточнение требований.*

---

## **3. Матрица трассировки требований (RTM)**

| ID требования | Описание требования | ID тест-кейса | Статус покрытия |
| :--- | :--- | :--- | :--- |
| **REQ-T3-01** | API возвращает стоимость продукта в формате JSON с HTTP-кодом 200 | TC-T3-001, TC-T3-002, TC-T3-003, TC-T3-004 | ✅ |
| **REQ-T3-02** | Расчет стоимости по таблице (30, 25, 20, 15, 10) | TC-T3-001, TC-T3-002, TC-T3-003, TC-T3-004 | ✅ |
| **REQ-T3-03** | Расчет выполняется нарастающим итогом | TC-T3-002, TC-T3-004 | ✅ |
| **REQ-T3-04** | Учет параметра start (уже приобретенные продукты) | TC-T3-002, TC-T3-004 | ✅ |
| **REQ-T3-05** | Партии по 5 экземпляров (count>5 разбивается на партии) | TC-T3-004 | ✅ |
| **REQ-T3-06** | authToken - обязательный параметр авторизации | TC-T3-005, TC-T3-006 | ✅ |
| **REQ-T3-07** | Продукт не найден → 404 | TC-T3-007 | ✅ |
| **REQ-T3-08** | Неверный/отсутствующий токен → 401 | TC-T3-005, TC-T3-006 | ✅ |
| **REQ-T3-09** | Обработка некорректных параметров (ошибка сервера) → 500 | TC-T3-008 | ✅ |
| **REQ-T3-10** | Определение статуса параметров count и start | TC-T3-009, TC-T3-010, TC-T3-011 | ⏳ |

---

## **4. Техники тест-дизайна**

| Техника | Описание применения | Примеры тест-кейсов |
| :--- | :--- | :--- |
| **Эквивалентное разделение** | Разделение значений count на классы: 1-5 (одна партия), 6-10 (две партии) и т.д. | TC-T3-001 (count=1), TC-T3-004 (count=7) |
| **Анализ граничных значений** | Проверка граничных значений count (1, 5, 6) и start (0, 4, 5) | TC-T3-001, TC-T3-003, TC-T3-004 |
| **Таблица принятия решений** | Использование таблицы стоимости для определения ожидаемых результатов | Все позитивные тесты с расчётами |
| **Предугадывание ошибок** | Проверка наиболее вероятных ошибок (отсутствие токена, несуществующий продукт) | TC-T3-005, TC-T3-006, TC-T3-007 |
| **Тестирование состояний и переходов** | Проверка переходов между партиями продуктов | TC-T3-004 |
| **Исследовательское тестирование** | Выяснение неопределённых аспектов требований | TC-T3-009, TC-T3-010, TC-T3-011 |

---

## **5. Примечания и рекомендации**

### **Для выполнения тестов необходимо:**
- Тестовое окружение с развернутым API
- Инструмент для отправки HTTP-запросов (Postman, curl, Insomnia и др.)
- Калькулятор для проверки сложных расчётов стоимости
- Валидные тестовые данные (productId, authToken)

### **При обнаружении дефектов рекомендуется:**
- Зафиксировать шаги воспроизведения с конкретными значениями параметров
- Указать фактический и ожидаемый результат расчёта
- Приложить скриншоты/логи запросов и ответов
- Для ошибок расчёта — показать расчёт вручную по таблице стоимости
- Создать баг-репорт с указанием серьезности и приоритета

### **Особенности тестирования T3:**
- **Бизнес-логика расчёта:** Стоимость рассчитывается по таблице с нарастающим итогом
- **Партии по 5 экземпляров:** При запросе более 5 продуктов стоимость считается партиями по 5
- **Параметры count и start:** Требуют уточнения обязательности (в отличие от T1, где явно указано "необязательные")
- **Авторизация:** authToken обязателен, проверяется формат 16 символов (цифры и буквы)
- **Обработка ошибок:**
   - При отсутствии токена или неверном токене → 401
   - При несуществующем продукте → 404
   - При внутренней ошибке сервера → 500 с JSON `{"errorMessage": "..."}`

### **Неопределённости, требующие уточнения:**
1. **Статус параметров `count` и `start`:**
   - В задании T1 явно указано: "Параметры необязательные"
   - В задании T3 аналогичного указания нет
   - Необходимо уточнить у команды: обязательные параметры или нет?

2. **Поведение при отсутствии параметров:**
   - Если параметры опциональные, каковы значения по умолчанию?
   - Если обязательные, какой код ошибки возвращать?

### **Рекомендации по тестированию:**
1. **Начинать с простых сценариев:** Сначала проверить базовые расчёты (1-5 продуктов, start=0)
2. **Использовать таблицу для проверки:** Подготовить таблицу с ожидаемыми результатами для ключевых комбинаций
3. **Проверять целостность данных:** Убедиться, что сумма нескольких запросов соответствует полной стоимости
4. **Тестировать переходы между партиями:** Особое внимание к случаям, когда start+count превышает 5
5. **Документировать расчёты:** Для сложных случаев показывать расчёт по шагам

---

## **6. Пример расчёта сложного сценария**
Для наглядности проверки логики работы API:
```text
Запрос: start=3, count=7
Расчёт:
1.  Начальная позиция: start=3 (уже куплено 3 продукта).
2.  Остаток в первой партии: 2 продукта (4-й и 5-й).
    Стоимость: 15 + 10 = 25
3.  Вторая полная партия: 5 продуктов.
    Стоимость: 30 + 25 + 20 + 15 + 10 = 100
4.  Третья партия: осталось 0 продуктов (7 - 2 - 5 = 0).
5.  Итого: 25 + 100 = 125
Ожидаемый результат в TC-T3-004: {"cost": 125}
```